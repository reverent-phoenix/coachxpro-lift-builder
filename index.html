<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CoachXPro Lift Builder ‚Äî Integrated Block</title>
  <style>
    :root { --red: #e10b0b; --gray: #f4f4f4; }
    #app, * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    #app { max-width: 720px; margin: 2rem auto; padding: 1rem; }
    .card { background: var(--gray); border-radius: 1rem; padding: 1rem; margin-bottom: 1.25rem; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    .title { font-weight: 600; margin-bottom: 0.5rem; }
    .options { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 0.25rem; }
    .opt { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; border: 2px solid transparent; border-radius: 0.75rem; background: #fff; cursor: pointer; }
    .opt:hover { border-color: var(--red); }
    .opt input { accent-color: var(--red); }
    .opt input:checked + span { font-weight: 600; color: var(--red); }
    button.next { width: 100%; padding: 0.75rem; background: var(--red); color: #fff; font-weight: 600; border: none; border-radius: 0.75rem; margin-top: 1rem; }
    button.next:disabled { opacity: 0.5; }
    .cat-head { margin: 0.75rem 0 0.25rem; font-weight: 600; }
    .req { font-size: 0.8rem; opacity: 0.7; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    // ====== Data Arrays ======
    const BB_CIRCUITS = {
      1: ["Rotational Step-Ups (L-R)", "Flys (bench)", "Lunges (L-R)", "Lat Pulldown", "Stooped Russian Twists w/ stop", "Good Mornings", "DB Alternating Toe Touches", "V-Sits", "Hanging Lateral Leg Lifts", "Twisting Sit-ups", "Pullovers", "Russian Twists (Hay Bales)"],
      2: ["Lunge w/ Twist", "Single-Arm Bent Over Row", "Weighted Crunches", "Straight-Leg Deadlift", "Arm Curls", "Seated Shoulder Press", "Lat Pulldown", "DB Alternating Toe Touches", "Dips", "Hanging Leg Lifts", "Push-ups (feet up)", "Back Hypers", "Pull-ups"],
      3: ["Russian Twists ‚Äì Standing", "Arm Curls", "DB Lateral Flys", "DB Alternating Toe Touches", "Rotational Step-Ups", "Weighted Crunches", "Inverted Row", "Russian Twist Lunge", "Hanging Knee Raises", "Single-Arm Row", "Military Press", "Straight-Leg Deadlift", "Weighted Back Hyper", "Hanging Ls"],
      4: ["Inverted Row", "Military Press", "Weighted Back Hyper", "Hanging Knee Raises", "Overhead Twist", "Toe Risers", "Crossover Step-Ups", "Face Pulls", "DB Lateral Flys", "Seated Good Morning", "V-Sits", "Hanging Leg Raise"]
    };
    const REGIONAL   = ["RDL","Hip Thrust","Step-Ups","DB Row","Lat Pull-Down","Nordic Curl"];
    const BALLISTIC  = ["Jump Squat","Trap-Bar Jump","Bench Press Throw","Overhead Med-Ball Throw","Split-Jerk Jump"];
    const OLYMPIC    = ["Power Clean","Hang Clean","Power Snatch","Mid-Thigh Clean Pull","Snatch Pull","Clean Pull","DB Snatch"];
    const STATIC     = ["Back Squat","Front Squat","Trap-Bar Deadlift","Conventional Deadlift","Split Squat (heavy)","Bench Press","Incline Bench","Weighted Pull-ups","Military Press","Weighted Dips"];
    const RS         = ["Continuous Hurdle Hops","Bounding Series","Single-Leg Pogos","Overhead Back MB Heave"];
    const LIFTS = { static: STATIC, regional: REGIONAL, olympic: OLYMPIC, ballistic: BALLISTIC, rs: RS };

    const SCHEMES = {
      RFD:  { sets:"5-9", reps:"1-2", pct:"90-100%", rest:"3-5 min" },
      RFDP: { sets:"4-9", reps:"2-4", pct:"70-85%", rest:"2-3 min" },
      BPD:  { sets:"4-9", reps:"4-5", pct:"50-65%", rest:"2-3 min" },
      ASD:  { sets:"4-8", reps:"1-5", pct:"80-100%", rest:"3-5 min" },
      ASC:  { sets:"3-6", reps:"4-8", pct:"60-80%", rest:"2-3 min" },
      BB:   { rest:"60-90 s" },
      RS:   { sets:"3-8", reps:"5-12", pct:"BW-50%", rest:"1-2 min" }
    };

    let S = {};
    const app = document.getElementById("app");

    // ===== Updated reqTable for integrated block specifics =====
    function reqTable(phase, sch) {
      const r = { static:0, olympic:0, ballistic:0, regional:0, rs:0, bb:0 };
      // Always include 1 static, 1 olympic, 1 ballistic, 1 regional (where applicable)
      r.static = 1;
      r.olympic = 1;
      r.ballistic = 1;
      r.regional = 1;
      // Now modify by phase:
      switch(phase) {
        case "acc":  // Accumulation: add bodybuilding circuit
          r.bb = 1;
          break;
        case "trans":// Transmutation: add reactive
          r.rs = 1;
          break;
        case "real": // Realization: focus on power, less regional
          r.regional = 0;
          r.rs = 1;
          break;
        case "main": // Maintenance: minimal strength
          r.static = 0;
          r.bb = 0;
          r.rs = 1;
          break;
      }
      return r;
    }

    function pres(cat, sch) {
      if(cat === "bb") return "60-90 s rest each";
      if(cat === "regional") return "3x8-10";
      if(cat === "ballistic") return "3x6 fast";
      if(cat === "rs") return SCHEMES.RS.sets + "x" + SCHEMES.RS.reps;
      const sc = SCHEMES[sch];
      return sc.sets + "x" + sc.reps + " @ " + sc.pct;
    }

    function radio(title, opts, key, next) {
      const card = document.createElement("div"); card.className="card";
      card.innerHTML = "<div class='title'>" + title + "</div>";
      const box = document.createElement("div"); box.className="options"; card.appendChild(box);
      opts.forEach(o => {
        box.insertAdjacentHTML("beforeend",
          "<label class='opt'><input type='radio' name='" + key + "' value='" + o.v + "'><span>" + o.t + "</span></label>"
        );
      });
      const btn = document.createElement("button"); btn.className="next"; btn.textContent="Next"; btn.disabled=true; card.appendChild(btn);
      card.addEventListener("change", () => btn.disabled=false);
      btn.onclick = () => { S[key] = card.querySelector("input:checked").value; next(); };
      return card;
    }

    function picker(req, next) {
      const card = document.createElement("div"); card.className="card";
      card.innerHTML = "<div class='title'>5Ô∏è‚É£ Choose your lifts</div>";
      if(req.bb) {
        card.insertAdjacentHTML("beforeend",
          "<p>Select bodybuilding circuit (60-90 s rest each)</p>"
        );
        Object.entries(BB_CIRCUITS).forEach(([n, arr]) => {
          card.insertAdjacentHTML("beforeend",
            "<label class='opt'><input type='radio' name='bbc' value='" + n + "'><span>Circuit #" + n + " (" + arr.length + " ex)</span></label>"
          );
        });
      }
      ["static","regional","olympic","ballistic","rs"].forEach(cat => {
        if(!req[cat]) return;
        card.insertAdjacentHTML("beforeend",
          "<div class='cat-head'>" + cat.toUpperCase() +
          " <span class='req'>(choose " + req[cat] + ")</span></div>"
        );
        const box = document.createElement("div"); box.className="options"; card.appendChild(box);
        LIFTS[cat].forEach(l => {
          box.insertAdjacentHTML("beforeend",
            "<label class='opt'><input type='checkbox' data-cat='" + cat + 
            "' value='" + l + "'><span><a href='#'>" + l + "</a></span></label>"
          );
        });
      });
      const btn = document.createElement("button"); btn.className="next"; btn.textContent="Finish"; btn.disabled=true; card.appendChild(btn);
      card.addEventListener("change", () => {
        let ok = true;
        if(req.bb) ok = !!card.querySelector("[name='bbc']:checked");
        const cnt = {}; Object.keys(req).forEach(k=>cnt[k]=0);
        card.querySelectorAll("input[type='checkbox']:checked").forEach(cb=>cnt[cb.dataset.cat]++);
        ok = ok && Object.keys(req).every(k=>!req[k]||k==="bb"||cnt[k]===req[k]);
        btn.disabled = !ok;
      });
      btn.onclick = () => {
        S.chosen = {};
        if(req.bb) {
          const n = card.querySelector("[name='bbc']:checked").value;
          S.chosen.bb = BB_CIRCUITS[n];
          S.bbRounds = (n==="4"?1:2);
        }
        card.querySelectorAll("input[type='checkbox']:checked").forEach(cb=>{
          (S.chosen[cb.dataset.cat]=S.chosen[cb.dataset.cat]||[]).push(cb.value);
        });
        next();
      };
      return card;
    }

    function summary() {
      const sc = SCHEMES[S.scheme];
      let html = "<div class='card'><h2 class='title'>üèãÔ∏è Your Workout</h2>";
      if(sc.sets) html += "<p><strong>Scheme:</strong> " + S.scheme + " ‚Üí " + sc.sets +
                        (sc.reps?("x" + sc.reps + " @ " + sc.pct):"") + "</p>";
      html += "<ul>";
      Object.entries(S.chosen).forEach(([cat, arr])=>{
        arr.forEach(l=>{
          html += "<li>" + l + " ‚Äî " + pres(cat, S.scheme) + "</li>";
        });
      });
      html += "</ul>";
      if(S.chosen.bb) html += "<p><em>Complete " + S.bbRounds + " round(s) of chosen BB circuit.</em></p>";
      html += "<button class='next' onclick='start()'>Start over</button></div>";
      app.innerHTML = html;
    }

    function start() {
      app.innerHTML = "";
      app.appendChild(radio("1Ô∏è‚É£ Season?",[
        {t:"Off-Season",v:"off"}, {t:"Pre-Season",v:"pre"}, {t:"In-Season",v:"in"}
      ],"season",()=>{
        app.innerHTML = "";
        app.appendChild(radio("2Ô∏è‚É£ Phase?",[
          {t:"Accumulation",v:"acc"}, {t:"Transmutation",v:"trans"},
          {t:"Realisation",v:"real"}, {t:"Maintenance",v:"main"}
        ],"phase",()=>{
          app.innerHTML = "";
          app.appendChild(radio("3Ô∏è‚É£ Track?",[
            {t:"Speed/Power",v:"speed"}, {t:"Strength",v:"strength"},
            {t:"Recovery",v:"recovery"}, {t:"Endurance",v:"endurance"}
          ],"track",()=>{
            app.innerHTML = "";
            let opts = [];
            if(S.track==="speed") opts=[{t:"Fresh",v:"RFD"},{t:"Somewhat fresh",v:"RFDP"},{t:"Tired",v:"BPD"}];
            else if(S.track==="strength") opts=[{t:"Heavy",v:"ASD"},{t:"Moderate",v:"ASC"}];
            else if(S.track==="recovery") opts=[{t:"Bodybuilding",v:"BB"}];
            else opts=[{t:"Maintain",v:"ASC"}];
            app.appendChild(radio("4Ô∏è‚É£ How do you feel?",opts,"scheme",()=>{
              const req = reqTable(S.phase,S.scheme);
              app.innerHTML = "";
              app.appendChild(picker(req, summary));
            }));
          }));
        }));
      }));
    }

    document.addEventListener("DOMContentLoaded", start);
  </script>
</body>
</html>
